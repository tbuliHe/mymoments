import{_ as we}from"./b72e89xr.js";import{_ as Ce}from"./k2lpch8j.js";import{l as Z,m as D,n as $e,a as H,_ as q,o as he,p as Me,q as Se}from"./mu41mkrl.js";import{_ as Ie,b as W,c as Ue,d as Be,a as Te,e as Ve,f as Ne,g as je,h as Ee,i as He}from"./bbphsdkx.js";import{a as Q,b as Re}from"./b8cufphi.js";import{e as A,r as M,o as s,i as k,w as b,a as o,b as m,d as U,C as Ae,h as e,v as X,c as u,a4 as Oe,A as T,f as R,l as Le,j as d,F as E,s as V,t as w,g as Fe,m as Pe,a5 as ze,E as De,n as Y,G as Je,H as Ge,D as P,p as z}from"./c6lvz2om.js";import{_ as Ye}from"./gvd3ebac.js";import{_ as Ke}from"./mjllnmi0.js";const Ze={class:"px-4 py-2"},qe={class:"flex gap-2 items-center"},ee=A({__name:"Confirm",emits:["ok","cancel"],setup(B,{emit:_}){const p=M(!1),x=_,r=()=>{p.value=!1,x("ok")},v=()=>{x("cancel"),p.value=!1};return(C,l)=>{const c=Q,S=Ie;return s(),k(S,{open:e(p),"onUpdate:open":l[3]||(l[3]=i=>X(p)?p.value=i:null)},{panel:b(()=>[o("div",Ze,[l[6]||(l[6]=o("p",{class:"text-gray-600 my-2"},"你确定要删除吗?",-1)),o("div",qe,[m(c,{onClick:l[1]||(l[1]=i=>r())},{default:b(()=>l[4]||(l[4]=[U("确定")])),_:1}),m(c,{color:"white",onClick:l[2]||(l[2]=i=>v())},{default:b(()=>l[5]||(l[5]=[U("取消")])),_:1})])])]),default:b(()=>[Ae(C.$slots,"default",{onClick:l[0]||(l[0]=i=>p.value=!0)})]),_:3},8,["open"])}}}),K=Z("memo-list-reload"),J=Z("memo-changed"),We=A({__name:"Emoji",emits:["selected"],setup(B,{emit:_}){const p=_,x=r=>{const v=r.target.innerHTML;p("selected",v)};return(r,v)=>(s(),u("div",{onClick:x,class:"flex flex-wrap gap-0.5 text-lg rounded border p-2 shadow-lg select-none mt-2 *:cursor-pointer"},v[0]||(v[0]=[Oe("<div>🤔</div><div>😐</div><div>😑</div><div>😶</div><div>🙄</div><div>😣</div><div>😏</div><div>😥</div><div>😮</div><div>🤐</div><div>😪</div><div>😯</div><div>😫</div><div>😴</div><div>😌</div><div>🤓</div><div>😛</div><div>😜</div><div>😝</div><div>🤤</div><div>😒</div><div>😓</div><div>😔</div><div>😕</div><div>🙃</div><div>🤑</div><div>😲</div><div>🤗</div><div>🙂</div><div>😚</div><div>😙</div><div>😗</div><div>😘</div><div>😍</div><div>😎</div><div>😋</div><div>😊</div><div>😉</div><div>😆</div><div>😅</div><div>😄</div><div>😃</div><div>🤣</div><div>😂</div><div>😁</div><div>😀</div><div>😷</div><div>🤒</div><div>🤕</div><div>🤢</div><div>🤧</div><div>😇</div><div>🤠</div><div>🤡</div><div>🤥</div><div>😈</div><div>👿</div><div>👹</div><div>👺</div><div>💀</div><div>☠️</div><div>👻</div><div>👽</div><div>💩</div>",64)])))}}),Qe={key:0,class:"px-4 py-2 flex flex-col gap-2 mt-2"},Xe={class:"relative"},et={class:"flex gap-1"},te=A({__name:"CommentBox",props:{commentId:{},memoId:{},replyTo:{}},setup(B){const _=B,p=T(()=>`${_.memoId}#${_.commentId}`),x=D(),r=$e("localCommentUserinfo",{username:"",website:""}),v=M(!1),C=R("currentCommentBox"),l=R("sysConfig"),c=Le({content:"",memoId:_.memoId,replyTo:_.replyTo,username:r.value.username,website:r.value.website}),S=async()=>{l.value.enableGoogleRecaptcha?grecaptcha.ready(()=>{grecaptcha.execute(l.value.googleSiteKey,{action:"newComment"}).then(async f=>{await i(f)})}):await i()},i=async f=>{if(x.value.userinfo.token||(r.value={username:c.username,website:c.website}),c.content.length>l.value.maxCommentLength){V.error("评论字数超过限制长度:"+l.value.maxCommentLength);return}await H("/comment/add",{...c,token:f}),V.success("评论成功!"),C.value="",c.username="",c.content="",c.website="",J.emit(_.memoId)},t=()=>{v.value=!v.value},h=f=>{c.content=c.content+f};return(f,g)=>{const O=Ke,N=Re,L=Q;return e(C)===e(p)?(s(),u("div",Qe,[o("div",Xe,[m(O,{rows:3,autofocus:"",placeholder:f.replyTo?`回复给${f.replyTo}`:"",modelValue:e(c).content,"onUpdate:modelValue":g[0]||(g[0]=I=>e(c).content=I)},null,8,["placeholder","modelValue"]),o("div",{class:"animate-bounce absolute right-2 bottom-1 cursor-pointer text-xl select-none",onClick:t},"😊 ")]),e(v)?(s(),k(We,{key:0,onSelected:h})):d("",!0),o("div",et,[e(x).userinfo.token?d("",!0):(s(),u(E,{key:0},[m(N,{placeholder:"姓名",modelValue:e(c).username,"onUpdate:modelValue":g[1]||(g[1]=I=>e(c).username=I)},null,8,["modelValue"]),m(N,{placeholder:"网站",modelValue:e(c).website,"onUpdate:modelValue":g[2]||(g[2]=I=>e(c).website=I)},null,8,["modelValue"])],64)),m(L,{color:"white",onClick:S},{default:b(()=>g[3]||(g[3]=[U("发布评论")])),_:1})])])):d("",!0)}}}),tt={key:0,class:"text-[#576b95] text-nowrap"},ot={key:1,class:"text-[#576b95] text-nowrap"},nt={class:"text-[#576b95] text-nowrap"},st={class:"text-xs text-gray-400 ml-2 hidden sm:inline-block"},it={key:3,class:"text-xs text-gray-400 ml-2 inline-flex"},at=A({__name:"Comment",props:{comment:{},memoId:{},memoUserId:{}},setup(B){const _=D(),p=R("currentCommentBox"),x=()=>{const C=r.memoId+"#"+r.comment.id;if(p.value===C){p.value="";return}p.value=C},r=B,v=async()=>{await H("/comment/remove?id="+r.comment.id),V.success("删除成功!"),J.emit(r.memoId)};return(C,l)=>{const c=W,S=q,i=ee;return s(),u(E,null,[o("div",null,[r.comment.author==r.memoUserId?(s(),u("span",tt,[U(w(r.comment.username)+" ",1),m(c,{color:"gray",variant:"solid",size:"xs"},{default:b(()=>l[0]||(l[0]=[U("作者")])),_:1})])):(s(),u("span",ot,w(r.comment.username),1)),r.comment.replyTo?(s(),u(E,{key:2},[l[1]||(l[1]=o("span",{class:"mx-1"},"回复",-1)),o("span",nt,w(r.comment.replyTo),1)],64)):d("",!0),l[2]||(l[2]=o("span",{class:"mx-0.5"},":",-1)),o("span",{class:"inline break-all cursor-pointer",onClick:x},w(r.comment.content),1),o("span",st,w(C.$dayjs(r.comment.createdAt).fromNow()),1),e(_).userinfo.id===r.memoUserId||e(_).userinfo.id===1?(s(),u("span",it,[m(i,{onOk:v},{default:b(()=>[m(S,{name:"i-carbon-trash-can",class:"cursor-pointer text-red-400"})]),_:1})])):d("",!0)]),m(te,{"memo-id":r.memoId,"reply-to":r.comment.username,"comment-id":r.comment.id},null,8,["memo-id","reply-to","comment-id"])],64)}}}),lt={class:"avatar"},rt={class:"flex flex-col gap-1 flex-1"},dt={class:"username text-[#576b95] mb-1 dark:text-white flex justify-between"},mt={class:"mb-2"},ct=["innerHTML"],ut={key:1,class:"flex gap-2 mt-2"},vt={class:"flex flex-col gap-2"},pt={key:0,class:"text-[#576b95] font-medium dark:text-white text-xs mt-2 mb-1 select-none flex items-center gap-0.5"},ft={class:"flex justify-between items-center relative"},_t={class:"flex text-xs text-[#9DA4B0]"},xt={class:"flex flex-row gap-2"},gt={class:"flex items-center justify-center gap-8 p-4 text-gray-500 dark:text-white"},yt={class:"flex flex-col gap-1 cursor-pointer items-center"},kt={class:"rounded bottom-shadow bg-[#f7f7f7] dark:bg-[#202020] flex flex-col gap-1"},bt={key:0,class:"flex flex-row py-2 px-4 gap-2 items-center text-sm"},wt={class:"text-[#576b95]"},Ct={class:"mx-1"},$t={key:1,class:"flex flex-col gap-1"},Nt=A({__name:"Memo",props:{memo:{}},setup(B){const _=M(!1),p=M(!1),x=T(()=>C.path.startsWith("/memo/")),r=M(null),v=R("sysConfig"),C=Fe(),l=()=>x.value||p.value?"":v.value.memoMaxHeight?`max-height:${v.value.memoMaxHeight}px`:"",c=R("currentCommentBox"),S=B,i=T(()=>JSON.parse(S.memo.ext||"{}")),t=T(()=>S.memo),h=D(),f=M(!1),g=M(!1),O=M(null),N=M(!1);he(O,()=>g.value=!1);const L=T(()=>(t.value.location||"").replaceAll(" "," · ")),I=T(()=>{const a=t.value.tags;if(!a)return[];const n=a.length;return a[n-1]===","?a.substring(0,n-1).split(","):a.split(",")}),oe=()=>{const a=t.value.id+"#0";c.value===a?c.value="":c.value=a,g.value=!1},ne=()=>{p.value=!p.value},se=async a=>{await z("/edit/"+a)},ie=async a=>{await H("/memo/remove?id="+a),V.success("删除成功!"),x.value?await z("/"):K.emit(),f.value=!1},ae=async a=>{await H("/memo/setPinned?id="+a),V.success("操作成功!"),x.value?await z("/"):K.emit(),f.value=!1},G=async(a,n="")=>{const j=JSON.parse(localStorage.getItem("likeMemos")||"[]");await H(`/memo/like?id=${a}&token=${n}`),V.success("点赞成功!"),j.push(a),localStorage.setItem("likeMemos",JSON.stringify(j)),J.emit(a),N.value=!0},le=async a=>{if(g.value=!1,JSON.parse(localStorage.getItem("likeMemos")||"[]").includes(a)){V.warning("您已经点赞过了!");return}v.value.enableGoogleRecaptcha?grecaptcha.ready(()=>{grecaptcha.execute(v.value.googleSiteKey,{action:"newComment"}).then(async j=>{await G(a,j)})}):await G(a)};Pe(()=>{const a=JSON.parse(localStorage.getItem("likeMemos")||"[]");N.value=a.findIndex(n=>n===t.value.id)>=0,x.value||setTimeout(()=>{const{height:n}=Me(r.value);n.value>v.value.memoMaxHeight&&(_.value=!0)},20)});const re=T(()=>{if(t.value.content&&t.value.content.length>0)try{return Se.render(t.value.content)}catch(a){return console.log("内容渲染错误,请重新编辑",a),"内容渲染错误,请重新编辑"}return""});return(a,n)=>{const j=we,F=Ce,$=q,de=W,me=Ue,ce=Be,ue=Te,ve=Ve,pe=Ne,fe=je,_e=Ee,xe=He,ge=ee,ye=Ye,ke=te;return s(),u("div",null,[o("div",{class:P(["relative flex gap-4 text-sm dark:bg-neutral-800 p-4",[e(t).pinned?"bg-slate-100 dark:bg-neutral-700":""]])},[o("div",lt,[m(F,{to:`/memo/${e(t).id}`},{default:b(()=>[m(j,{src:e(t).user.avatarUrl,alt:"Avatar"},null,8,["src"])]),_:1},8,["to"])]),o("div",rt,[o("div",dt,[m(F,{class:"cursor-pointer",to:`/user/${e(t).user.id}`},{default:b(()=>[U(w(e(t).user.nickname),1)]),_:1},8,["to"]),o("div",null,[e(t).pinned?(s(),k($,{key:0,name:"i-carbon-pin"})):d("",!0),e(t).showType===0?(s(),k($,{key:1,name:"i-carbon-locked",class:"text-red-500 ml-2 dark:text-white"})):d("",!0),(a._.provides[ze]||a.$route).path===`/memo/${e(t).id}`&&(e(h).userinfo.id===1||e(h).userinfo.id===e(t).userId)?(s(),k($,{key:2,name:"i-iconamoon-menu-kebab-vertical-bold",class:"text-red-500 ml-2 dark:text-white cursor-pointer",onClick:n[0]||(n[0]=y=>f.value=!0)})):d("",!0)])]),o("div",mt,[o("div",{style:De(l()),class:"overflow-hidden"},[o("div",{class:"markdown-content",ref_key:"contentRef",ref:r,innerHTML:e(re)},null,8,ct)],4),e(_)?(s(),u("div",{key:0,class:"text-[#576b95] text-sm my-1 cursor-pointer",onClick:ne},w(l()===""?"收起":"全文"),1)):d("",!0),e(I).length>0?(s(),u("div",ut,[(s(!0),u(E,null,Y(e(I),(y,be)=>(s(),u("span",{key:`tag-${be}`},[m(F,{to:`/tags/${e(t).user.username}/${y}`},{default:b(()=>[m(de,{size:"xs",color:"gray",variant:"solid"},{default:b(()=>[U(w(y),1)]),_:2},1024)]),_:2},1032,["to"])]))),128))])):d("",!0)]),o("div",vt,[e(t).externalFavicon&&e(t).externalTitle&&e(t).externalUrl?(s(),k(me,{key:0,favicon:e(t).externalFavicon,title:e(t).externalTitle,url:e(t).externalUrl},null,8,["favicon","title","url"])):d("",!0),m(ce,{imgs:e(t).imgs||"","memo-id":e(t).id},null,8,["imgs","memo-id"]),e(i).music&&e(i).music.id?(s(),k(ue,Je(Ge({key:1},e(i).music)),null,16)):d("",!0),e(i).doubanBook&&e(i).doubanBook.title?(s(),k(ve,{key:2,book:e(i).doubanBook},null,8,["book"])):d("",!0),e(i).doubanMovie&&e(i).doubanMovie.title?(s(),k(pe,{key:3,movie:e(i).doubanMovie},null,8,["movie"])):d("",!0),e(i).video&&e(i).video.type==="youtube"&&e(i).video.value?(s(),k(fe,{key:4,url:e(i).video.value},null,8,["url"])):d("",!0),e(i).video&&e(i).video.type==="bilibili"&&e(i).video.value?(s(),k(_e,{key:5,url:e(i).video.value},null,8,["url"])):d("",!0),e(i).video&&e(i).video.type==="online"&&e(i).video.value?(s(),k(xe,{key:6,url:e(i).video.value},null,8,["url"])):d("",!0)]),e(L)?(s(),u("div",pt,[m($,{name:"i-carbon-location"}),o("span",null,w(e(L)),1)])):d("",!0),o("div",ft,[o("div",_t,w(e(v).timeFormat==="timeAgo"?a.$dayjs(e(t).createdAt).fromNow():a.$dayjs(e(t).createdAt).format("YYYY-MM-DD HH:mm:ss")),1),o("div",{onClick:n[1]||(n[1]=y=>g.value=!0),class:"toolbar-icon px-2 py-1 bg-[#f7f7f7] dark:bg-slate-700 hover:bg-[#dedede] cursor-pointer rounded flex items-center justify-center"},n[8]||(n[8]=[o("img",{src:"data:image/svg+xml,%3csvg%20t='1709204592505'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='16237'%20width='16'%20height='16'%3e%3cpath%20d='M229.2%20512m-140%200a140%20140%200%201%200%20280%200%20140%20140%200%201%200-280%200Z'%20p-id='16238'%20fill='%238a8a8a'%3e%3c/path%3e%3cpath%20d='M794.8%20512m-140%200a140%20140%200%201%200%20280%200%20140%20140%200%201%200-280%200Z'%20p-id='16239'%20fill='%238a8a8a'%3e%3c/path%3e%3c/svg%3e",class:"w-3 h-3"},null,-1)])),e(g)?(s(),u("div",{key:0,ref_key:"toolbarRef",ref:O,class:"absolute top-[-8px] right-[32px] bg-[#4c4c4c] rounded text-white p-2"},[o("div",xt,[o("div",{class:"flex flex-row gap-1 cursor-pointer items-center px-4",onClick:n[2]||(n[2]=y=>le(e(t).id))},[m($,{name:"i-carbon-favorite",class:P([e(N)?"text-red-400":""])},null,8,["class"]),n[9]||(n[9]=o("div",null,"赞",-1))]),e(v).enableComment?(s(),u(E,{key:0},[n[11]||(n[11]=o("span",{class:"bg-[#6b7280] h-[20px] w-[1px]"},null,-1)),o("div",{class:"flex flex-row gap-1 cursor-pointer items-center px-4",onClick:oe},[m($,{name:"i-octicon-comment"}),n[10]||(n[10]=o("div",null,"评论",-1))])],64)):d("",!0)])],512)):d("",!0),o("template",null,[m(ye,{modelValue:e(f),"onUpdate:modelValue":n[7]||(n[7]=y=>X(f)?f.value=y:null),ui:{container:"sm:items-end"}},{default:b(()=>[o("div",gt,[e(h).userinfo.id===1?(s(),u("div",{key:0,class:"flex flex-col gap-1 cursor-pointer items-center",onClick:n[3]||(n[3]=y=>ae(e(t).id))},[m($,{class:"text-[#9fc84a] w-5 h-5",name:"i-carbon-pin"}),o("div",null,w(e(t).pinned?"取消":"")+"置顶",1)])):d("",!0),e(h)&&e(h).userinfo.id===e(t).userId?(s(),u("div",{key:1,class:"flex flex-col gap-1 cursor-pointer items-center",onClick:n[4]||(n[4]=y=>se(e(t).id))},[m($,{class:"text-[#9fc84a] w-5 h-5",name:"i-carbon-edit"}),n[12]||(n[12]=o("div",null,"编辑",-1))])):d("",!0),e(h).userinfo.id===1||e(h).userinfo.id===e(t).userId?(s(),k(ge,{key:2,onOk:n[5]||(n[5]=y=>ie(e(t).id)),onCancel:n[6]||(n[6]=y=>f.value=!1)},{default:b(()=>[o("div",yt,[m($,{class:"text-[#9fc84a] w-5 h-5",name:"i-carbon-trash-can"}),n[13]||(n[13]=o("div",null,"删除",-1))])]),_:1})):d("",!0)])]),_:1},8,["modelValue"])])]),o("div",kt,[e(t).favCount>0?(s(),u("div",bt,[m($,{name:"i-carbon-favorite",class:"text-red-500"}),o("div",wt,[o("span",Ct,w(e(t).favCount),1),n[14]||(n[14]=U("位访客"))])])):d("",!0),e(v).enableComment?(s(),u("div",$t,[m(ke,{"comment-id":0,"memo-id":e(t).id},null,8,["memo-id"]),o("div",{class:P(["space-y-1",[e(t).comments&&e(t).comments.length>0?"py-2":""]])},[e(t).comments&&e(t).comments.length>0?(s(!0),u(E,{key:0},Y(e(t).comments,y=>(s(),u("div",{class:"px-4 relative flex-col text-sm",key:y.id},[m(at,{comment:y,"memo-id":e(t).id,"memo-user-id":e(t).user.id},null,8,["comment","memo-id","memo-user-id"])]))),128)):d("",!0)],2)])):d("",!0)])])],2)])}}});export{Nt as _,J as a,K as m};
