import{b as qe,a as te,_ as oe,c as le,d as ye,e as Je,g as se,o as Ke,f as Ye,h as Ze}from"./mu41mkrl.js";import{b as Q,a as W,c as Qe,u as _e}from"./b8cufphi.js";import{_ as ae}from"./wo62k5hj.js";import{_ as We}from"./b72e89xr.js";import{_ as X,a as xe,b as Xe,c as et,d as tt,e as lt,f as ot,g as at,h as nt,i as st}from"./bbphsdkx.js";import{e as N,q as Z,r as w,o as y,i as S,w as d,a as v,b as s,h as l,d as z,s as G,k as we,v as D,j as M,x as ne,y as F,z as E,A,B as H,c as U,C as q,D as I,E as rt,t as T,G as ke,H as R,F as ve,n as me,I as it,J as he,K as ut,L as dt,M as ct,N as pt,T as vt,l as mt,m as ft,O as gt,p as be}from"./c6lvz2om.js";import{_ as $e}from"./clew9nxz.js";import{_ as bt}from"./cvxw6bcr.js";import{_ as re}from"./ou69qqfo.js";import{u as yt,_ as Ue}from"./mjllnmi0.js";import{_ as _t}from"./di7jvcfs.js";const xt={wrapper:"w-full flex flex-col gap-2",indicator:{container:{base:"flex flex-row justify-end",width:"min-w-fit",transition:"transition-all"},align:"text-end",width:"w-fit",color:"text-gray-400 dark:text-gray-500",size:{"2xs":"text-xs",xs:"text-xs",sm:"text-sm",md:"text-sm",lg:"text-sm",xl:"text-base","2xl":"text-base"}},progress:{base:"block appearance-none border-none overflow-hidden",width:"w-full [&::-webkit-progress-bar]:w-full",size:{"2xs":"h-px",xs:"h-0.5",sm:"h-1",md:"h-2",lg:"h-3",xl:"h-4","2xl":"h-5"},rounded:"rounded-full [&::-webkit-progress-bar]:rounded-full",track:"[&::-webkit-progress-bar]:bg-gray-200 [&::-webkit-progress-bar]:dark:bg-gray-700 [@supports(selector(&::-moz-progress-bar))]:bg-gray-200 [@supports(selector(&::-moz-progress-bar))]:dark:bg-gray-700",bar:"[&::-webkit-progress-value]:rounded-full [&::-webkit-progress-value]:transition-all [&::-webkit-progress-value]:ease-in-out [&::-moz-progress-bar]:rounded-full",color:"text-{color}-500 dark:text-{color}-400",background:"[&::-webkit-progress-value]:bg-current [&::-moz-progress-bar]:bg-current",indeterminate:{base:"indeterminate:relative",rounded:"indeterminate:after:rounded-full [&:indeterminate::-webkit-progress-value]:rounded-full [&:indeterminate::-moz-progress-bar]:rounded-full"}},steps:{base:"grid grid-cols-1",color:"text-{color}-500 dark:text-{color}-400",size:{"2xs":"text-xs",xs:"text-xs",sm:"text-sm",md:"text-sm",lg:"text-sm",xl:"text-base","2xl":"text-base"}},step:{base:"transition-all opacity-0 truncate row-start-1 col-start-1",align:"text-end",active:"opacity-100",first:"text-gray-500 dark:text-gray-400"},animation:{carousel:"bar-animation-carousel","carousel-inverse":"bar-animation-carousel-inverse",swing:"bar-animation-swing",elastic:"bar-animation-elastic"},default:{color:"primary",size:"md",animation:"carousel"}},wt={wrapper:"relative flex items-start",fieldset:"",legend:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",default:{color:"primary"}},Ce={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},kt={wrapper:"relative",container:"z-20 group",width:"",background:"bg-white dark:bg-gray-900",shadow:"shadow-lg",rounded:"rounded-md",ring:"ring-1 ring-gray-200 dark:ring-gray-800",base:"overflow-hidden focus:outline-none relative",transition:{enterActiveClass:"transition ease-out duration-200",enterFromClass:"opacity-0 translate-y-1",enterToClass:"opacity-100 translate-y-0",leaveActiveClass:"transition ease-in duration-150",leaveFromClass:"opacity-100 translate-y-0",leaveToClass:"opacity-0 translate-y-1"},popper:{placement:"bottom-start",scroll:!1},arrow:qe},ht={class:"p-4 flex flex-col gap-2"},$t={class:"flex gap-2"},Ut={class:"w-fit"},Ct=N({__name:"ExternalUrl",props:{url:{},urlModifiers:{},favicon:{},faviconModifiers:{},title:{},titleModifiers:{}},emits:["update:url","update:favicon","update:title"],setup(e){const o=Z(e,"url"),n=Z(e,"favicon"),m=Z(e,"title"),p=w(!1),f=t=>{n.value="",o.value="",m.value="",t()},c=async t=>{if(o.value&&m.value&&n.value){t();return}G.error("请完整填写相关内容")},a=async()=>{if(!o.value){G.error("请先填写地址");return}p.value=!0;try{const t=await te("/memo/getFaviconAndTitle?url="+encodeURIComponent(o.value));m.value=t.title,n.value=t.favicon}finally{p.value=!1}};return(t,u)=>{const k=oe,C=Q,$=W,V=ae,b=We,B=X;return y(),S(B,{popper:{arrow:!0},mode:"click"},{panel:d(({close:_})=>[v("div",ht,[s(C,{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=i=>o.value=i),placeholder:"请输入分享的链接"},null,8,["modelValue"]),s(V,null,{default:d(()=>[s(C,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=i=>m.value=i),placeholder:"请输入分享的标题"},null,8,["modelValue"]),s($,{color:"white",variant:"solid",onClick:a,disabled:l(p),loading:l(p)},{default:d(()=>u[3]||(u[3]=[z("自动获取标题 ")])),_:1},8,["disabled","loading"])]),_:1}),v("div",$t,[s(C,{modelValue:n.value,"onUpdate:modelValue":u[2]||(u[2]=i=>n.value=i),class:"flex-1",placeholder:"请输入分享的favicon地址"},null,8,["modelValue"]),s(b,{src:n.value,size:"xs"},null,8,["src"])]),v("div",Ut,[s(V,null,{default:d(()=>[s($,{onClick:i=>c(_)},{default:d(()=>u[4]||(u[4]=[z("确定")])),_:2},1032,["onClick"]),s($,{color:"white",variant:"solid",onClick:i=>f(_)},{default:d(()=>u[5]||(u[5]=[z("清空并关闭")])),_:2},1032,["onClick"])]),_:2},1024)])])]),default:d(()=>[s(k,{name:"i-carbon-link",class:"w-6 h-6"})]),_:1})}}}),Vt={class:"p-4 flex flex-col gap-2 max-h-[400px] overflow-auto"},Mt={class:"text-xs text-gray-400"},zt={class:"flex gap-2"},At=N({__name:"Music",props:{id:{default:""},server:{default:"netease"},type:{default:"song"},api:{default:"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r"}},emits:["confirm"],setup(e,{emit:o}){const n=e,m=w(n.id),p=w(n.server),f=w(n.type),c=w(n.api),a=o;we(n,()=>{m.value=n.id,p.value=n.server,f.value=n.type,c.value=n.api});const t=w(!1),u=w(!1),k=B=>{if(!p.value||!c.value||!m.value||!f.value){G.error("请完整填写所需信息");return}t.value=!1,u.value=!0,setTimeout(()=>{t.value=!0,u.value=!1},500)},C=B=>{a("confirm",{id:m.value,server:p.value,type:f.value,api:c.value}),B()},$=B=>{t.value=!1,m.value="",p.value="netease",f.value="song",c.value="https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r",a("confirm",{id:m.value,server:p.value,type:f.value,api:c.value}),B()},V=w([{value:"netease",label:"网易云音乐"},{value:"tencent",label:"QQ音乐"},{value:"kugou",label:"酷狗音乐"},{value:"xiami",label:"虾米音乐"},{value:"baidu",label:"百度音乐"}]),b=w([{value:"song",label:"歌曲"},{value:"playlist",label:"播放列表"},{value:"album",label:"专辑"},{value:"search",label:"搜索"},{value:"artist",label:"艺术家"}]);return(B,_)=>{const i=oe,x=Qe,O=$e,j=bt,P=Q,ee=xe,J=W,K=X;return y(),S(K,{ui:{base:"w-[350px] min-h-[350px]"},popper:{arrow:!0},mode:"click"},{panel:d(({close:g})=>[v("div",Vt,[_[8]||(_[8]=v("div",{class:"text-xs text-gray-400"},"嵌入在线音乐",-1)),s(j,{label:"选择平台",ui:{label:{base:"font-bold"}}},{hint:d(()=>[v("div",Mt,[s(x,{class:"underline",target:"_blank",to:"https://github.com/metowolf/MetingJS"},{default:d(()=>_[4]||(_[4]=[z("MetingJS文档")])),_:1})])]),default:d(()=>[s(O,{modelValue:l(p),"onUpdate:modelValue":_[0]||(_[0]=r=>D(p)?p.value=r:null),options:l(V),"value-attribute":"value","option-attribute":"label",placeholder:"选择平台"},null,8,["modelValue","options"])]),_:1}),s(j,{label:"选择类型",ui:{label:{base:"font-bold"}}},{default:d(()=>[s(O,{modelValue:l(f),"onUpdate:modelValue":_[1]||(_[1]=r=>D(f)?f.value=r:null),options:l(b),"value-attribute":"value","option-attribute":"label",placeholder:"选择平台"},null,8,["modelValue","options"])]),_:1}),s(j,{label:"ID",ui:{label:{base:"font-bold"}}},{default:d(()=>[s(P,{modelValue:l(m),"onUpdate:modelValue":_[2]||(_[2]=r=>D(m)?m.value=r:null),placeholder:"输入歌曲ID/播放列表ID/专辑ID"},null,8,["modelValue"])]),_:1}),s(j,{label:"API接口地址",ui:{label:{base:"font-bold"}}},{default:d(()=>[s(P,{modelValue:l(c),"onUpdate:modelValue":_[3]||(_[3]=r=>D(c)?c.value=r:null)},null,8,["modelValue"])]),_:1}),l(t)?(y(),S(ee,{key:0,id:l(m),server:l(p),type:l(f),api:l(c)},null,8,["id","server","type","api"])):M("",!0),v("div",zt,[s(J,{color:"indigo",variant:"solid",onClick:r=>k(g),disabled:l(u),loading:l(u)},{default:d(()=>_[5]||(_[5]=[z("预览 ")])),_:2},1032,["onClick","disabled","loading"]),s(J,{onClick:r=>C(g)},{default:d(()=>_[6]||(_[6]=[z("确定")])),_:2},1032,["onClick"]),s(J,{color:"white",onClick:r=>$(g)},{default:d(()=>_[7]||(_[7]=[z("清空")])),_:2},1032,["onClick"])])])]),default:d(()=>[s(i,{name:"i-carbon-music",class:"cursor-pointer w-6 h-6"})]),_:1})}}}),Y=ne(F.ui.strategy,F.ui.progress,xt),Bt=N({inheritAttrs:!1,props:{value:{type:Number,default:null},max:{type:[Number,Array],default:100},indicator:{type:Boolean,default:!1},animation:{type:String,default:()=>Y.default.animation,validator(e){return Object.keys(Y.animation).includes(e)}},size:{type:String,default:()=>Y.default.size,validator(e){return Object.keys(Y.progress.size).includes(e)}},color:{type:String,default:()=>Y.default.color,validator(e){return F.ui.colors.includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(e){const{ui:o,attrs:n}=le("progress",E(e,"ui"),Y,E(e,"class")),m=A(()=>H(o.value.indicator.container.base,o.value.indicator.container.width,o.value.indicator.container.transition)),p=A(()=>H(o.value.indicator.align,o.value.indicator.width,o.value.indicator.color,o.value.indicator.size[e.size])),f=A(()=>{var x;const i=[o.value.progress.base,o.value.progress.width,o.value.progress.size[e.size],o.value.progress.rounded,o.value.progress.track,o.value.progress.bar,(x=o.value.progress.color)==null?void 0:x.replaceAll("{color}",e.color),o.value.progress.background,o.value.progress.indeterminate.base,o.value.progress.indeterminate.rounded];return V.value&&i.push(o.value.animation[e.animation]),H(...i)}),c=A(()=>{var i;return H(o.value.steps.base,(i=o.value.steps.color)==null?void 0:i.replaceAll("{color}",e.color),o.value.steps.size[e.size])}),a=A(()=>H(o.value.step.base,o.value.step.align)),t=A(()=>H(o.value.step.active)),u=A(()=>H(o.value.step.first));function k(i){return i===Number(e.value)}function C(i){return i===0}function $(i){i=Number(i);const x=[a.value];return C(i)&&x.push(u.value),k(i)&&x.push(t.value),x.join(" ")}const V=A(()=>e.value===void 0||e.value===null),b=A(()=>Array.isArray(e.max)),B=A(()=>V.value?null:Array.isArray(e.max)?e.max.length-1:Number(e.max)),_=A(()=>{if(!V.value)switch(!0){case e.value<0:return 0;case e.value>B.value:return 100;default:return e.value/B.value*100}});return{ui:o,attrs:n,indicatorContainerClass:m,indicatorClass:p,progressClass:f,stepsClass:c,stepClasses:$,isIndeterminate:V,isSteps:b,realMax:B,percent:_}}}),Ot=["aria-valuemax","aria-valuenow"];function Tt(e,o,n,m,p,f){return y(),U("div",{class:I(e.ui.wrapper),role:"progressbar"},[e.indicator||e.$slots.indicator?q(e.$slots,"indicator",ke(R({key:0},{percent:e.percent})),()=>[e.isSteps?M("",!0):(y(),U("div",{key:0,class:I(e.indicatorContainerClass),style:rt({width:`${e.percent}%`})},[v("div",{class:I(e.indicatorClass)},T(Math.round(e.percent))+"% ",3)],6))],!0):M("",!0),v("progress",R({"aria-valuemax":e.realMax,"aria-valuenow":e.value,class:e.progressClass},{value:e.value,max:e.realMax,...e.attrs}),T(e.percent!==void 0?`${Math.round(e.percent)}%`:void 0),17,Ot),e.isSteps?(y(),U("div",{key:1,class:I(e.stepsClass)},[(y(!0),U(ve,null,me(e.max,(c,a)=>(y(),U("div",{key:a,class:I(e.stepClasses(a))},[q(e.$slots,`step-${a}`,R({ref_for:!0},{step:c}),()=>[z(T(c),1)],!0)],2))),128))],2)):M("",!0)],2)}const Ve=re(Bt,[["render",Tt],["__scopeId","data-v-ad1402c1"]]),St={class:"p-4 flex flex-col gap-2"},It={key:0,class:"text-xs text-gray-400"},jt={key:1,class:"text-xs text-gray-400"},Ft=N({__name:"UploadVideo",props:{type:{default:"youtube"},value:{default:""}},emits:["confirm"],setup(e,{emit:o}){const n=e,m=o,p=w(n.type),f=w(""),c=w(""),a=w(""),t=[/v=([^&#]+)/,/youtu\.be\/(.*)\?/],u=w(0),k=w(""),C=w(0),$=w(0);we(n,()=>{p.value=n.type,n.type==="youtube"?f.value=n.value:n.type==="bilibili"?c.value=n.value:n.type==="online"&&(a.value=n.value)});const V=async _=>{for(let x=0;x<_.length;x++)if(_[x].type.indexOf("video")<0){G.error("只能上传视频文件");return}const i=await ye(_,(x,O,j,P)=>{u.value=Math.round(P*100),k.value=j,C.value=x,$.value=O});G.success("上传成功"),i&&(a.value=i[0])},b=_=>{const i=c.value.match(/src=['"]([^'"]+)['"]/);if(c.value.trim()){if(p.value="bilibili",i&&i.length>1)m("confirm",{type:p.value,value:c.value}),_();else{G.warning("无效的B站视频地址");return}return}if(f.value.trim()){p.value="youtube";let x=!1;for(let O=0;O<t.length;O++){const j=f.value.match(t[O]);if(j&&j.length>1){x=!0;break}}x?(m("confirm",{type:p.value,value:f.value}),_()):G.warning("无效的Youtube视频地址");return}if(a.value.trim()){p.value="online",m("confirm",{type:p.value,value:a.value.trim()}),_();return}},B=_=>{p.value="youtube",f.value="",c.value="",a.value="",m("confirm",{type:p.value,value:""})};return(_,i)=>{const x=oe,O=Q,j=Ve,P=W,ee=ae,J=X;return y(),S(J,{ui:{base:"w-[300px]"},popper:{arrow:!0},mode:"click"},{panel:d(({close:K})=>[v("div",St,[i[7]||(i[7]=v("div",{class:"text-xs text-gray-400"},"嵌入b站视频",-1)),s(O,{type:"text",size:"sm",modelValue:l(c),"onUpdate:modelValue":i[0]||(i[0]=g=>D(c)?c.value=g:null)},{leading:d(()=>i[3]||(i[3]=[v("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"24",height:"24",viewBox:"0 0 48 48"},[v("path",{fill:"#1e88e5",d:"M36.5,12h-7.086l3.793-3.793c0.391-0.391,0.391-1.023,0-1.414s-1.023-0.391-1.414,0L26.586,12 h-5.172l-5.207-5.207c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414L18.586,12H12.5C9.467,12,7,14.467,7,17.5v15 c0,3.033,2.467,5.5,5.5,5.5h2c0,0.829,0.671,1.5,1.5,1.5s1.5-0.671,1.5-1.5h14c0,0.829,0.671,1.5,1.5,1.5s1.5-0.671,1.5-1.5h2 c3.033,0,5.5-2.467,5.5-5.5v-15C42,14.467,39.533,12,36.5,12z M39,32.5c0,1.378-1.122,2.5-2.5,2.5h-24c-1.378,0-2.5-1.122-2.5-2.5 v-15c0-1.378,1.122-2.5,2.5-2.5h24c1.378,0,2.5,1.122,2.5,2.5V32.5z"}),v("rect",{width:"2.75",height:"7.075",x:"30.625",y:"18.463",fill:"#1e88e5",transform:"rotate(-71.567 32.001 22)"}),v("rect",{width:"7.075",height:"2.75",x:"14.463",y:"20.625",fill:"#1e88e5",transform:"rotate(-18.432 17.998 21.997)"}),v("path",{fill:"#1e88e5",d:"M28.033,27.526c-0.189,0.593-0.644,0.896-1.326,0.896c-0.076-0.013-0.139-0.013-0.24-0.025 c-0.013,0-0.05-0.013-0.063,0c-0.341-0.05-0.745-0.177-1.061-0.467c-0.366-0.265-0.808-0.745-0.947-1.477 c0,0-0.29,1.174-0.896,1.49c-0.076,0.05-0.164,0.114-0.253,0.164l-0.038,0.025c-0.303,0.164-0.682,0.265-1.086,0.278 c-0.568-0.051-0.947-0.328-1.136-0.821l-0.063-0.164l-1.427,0.656l0.05,0.139c0.467,1.124,1.465,1.768,2.74,1.768 c0.922,0,1.667-0.303,2.209-0.909c0.556,0.606,1.288,0.909,2.209,0.909c1.856,0,2.55-1.288,2.765-1.843l0.051-0.126l-1.427-0.657 L28.033,27.526z"})],-1)])),_:1},8,["modelValue"]),i[8]||(i[8]=v("div",{class:"text-xs text-gray-400"},"嵌入Youtube站视频",-1)),s(O,{type:"text",size:"sm",icon:"i-carbon-video-player",modelValue:l(f),"onUpdate:modelValue":i[1]||(i[1]=g=>D(f)?f.value=g:null)},{leading:d(()=>i[4]||(i[4]=[v("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"24",height:"24",viewBox:"0 0 48 48"},[v("path",{fill:"#FF3D00",d:"M43.2,33.9c-0.4,2.1-2.1,3.7-4.2,4c-3.3,0.5-8.8,1.1-15,1.1c-6.1,0-11.6-0.6-15-1.1c-2.1-0.3-3.8-1.9-4.2-4C4.4,31.6,4,28.2,4,24c0-4.2,0.4-7.6,0.8-9.9c0.4-2.1,2.1-3.7,4.2-4C12.3,9.6,17.8,9,24,9c6.2,0,11.6,0.6,15,1.1c2.1,0.3,3.8,1.9,4.2,4c0.4,2.3,0.9,5.7,0.9,9.9C44,28.2,43.6,31.6,43.2,33.9z"}),v("path",{fill:"#FFF",d:"M20 31L20 17 32 24z"})],-1)])),_:1},8,["modelValue"]),i[9]||(i[9]=v("div",{class:"text-xs text-gray-400"},"嵌入在线站视频",-1)),s(O,{type:"text",size:"sm",modelValue:l(a),"onUpdate:modelValue":i[2]||(i[2]=g=>D(a)?a.value=g:null)},{leading:d(()=>[s(x,{name:"i-carbon-video-player",class:"w-6 h-6"})]),_:1},8,["modelValue"]),i[10]||(i[10]=v("div",{class:"text-xs text-gray-400"},"上传本地视频",-1)),s(O,{type:"file",size:"sm",icon:"i-heroicons-folder",onChange:V}),l(k)?(y(),U("p",It,"正在上传("+T(l($))+"/"+T(l(C))+")",1)):M("",!0),l(k)?(y(),U("p",jt,T(l(k)),1)):M("",!0),l(u)>0?(y(),S(j,{key:2,value:l(u),indicator:""},null,8,["value"])):M("",!0),s(ee,null,{default:d(()=>[s(P,{onClick:g=>b(K)},{default:d(()=>i[5]||(i[5]=[z("确定")])),_:2},1032,["onClick"]),s(P,{color:"white",onClick:g=>B(K)},{default:d(()=>i[6]||(i[6]=[z("清空")])),_:2},1032,["onClick"])]),_:2},1024)])]),default:d(()=>[s(x,{name:"i-carbon-video-player",class:"cursor-pointer w-6 h-6"})]),_:1})}}}),ce=ne(F.ui.strategy,F.ui.radio,Ce),Rt=N({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>ce.default.color,validator(e){return F.ui.colors.includes(e)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:o}){const{ui:n,attrs:m}=le("radio",E(e,"ui"),ce,E(e,"class")),p=e.id??Je("$OKAmAGA912"),f=it("radio-group",null),{emitFormChange:c,color:a,name:t}=f??_e(e,ce),u=A({get(){return e.modelValue},set($){o("update:modelValue",$),f||c()}});function k($){o("change",$.target.value)}const C=A(()=>he(H(n.value.base,n.value.form,n.value.background,n.value.border,a.value&&n.value.ring.replaceAll("{color}",a.value),a.value&&n.value.color.replaceAll("{color}",a.value)),e.inputClass));return{inputId:p,ui:n,attrs:m,pick:u,name:t,inputClass:C,onChange:k}}}),Lt=["data-n-ids"],Dt=["id","name","required","value","disabled"],Gt=["for"];function Nt(e,o,n,m,p,f){return y(),U("div",{class:I(e.ui.wrapper),"data-n-ids":e.attrs["data-n-ids"]},[v("div",{class:I(e.ui.container)},[ut(v("input",R({id:e.inputId,"onUpdate:modelValue":o[0]||(o[0]=c=>e.pick=c),name:e.name,required:e.required,value:e.value,disabled:e.disabled,type:"radio",class:e.inputClass},e.attrs,{onChange:o[1]||(o[1]=(...c)=>e.onChange&&e.onChange(...c))}),null,16,Dt),[[dt,e.pick]])],2),e.label||e.$slots.label?(y(),U("div",{key:0,class:I(e.ui.inner)},[v("label",{for:e.inputId,class:I(e.ui.label)},[q(e.$slots,"label",{label:e.label},()=>[z(T(e.label),1)]),e.required?(y(),U("span",{key:0,class:I(e.ui.required)},"*",2)):M("",!0)],10,Gt),e.help||e.$slots.help?(y(),U("p",{key:0,class:I(e.ui.help)},[q(e.$slots,"help",{help:e.help},()=>[z(T(e.help),1)])],2)):M("",!0)],2)):M("",!0)],10,Lt)}const Me=re(Rt,[["render",Nt]]),pe=ne(F.ui.strategy,F.ui.radioGroup,wt),Pt=ne(F.ui.strategy,F.ui.radio,Ce),Ht=N({components:{URadio:Me},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object,Boolean],default:""},name:{type:String,default:null},legend:{type:String,default:null},options:{type:Array,default:()=>[]},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},disabled:{type:Boolean,default:!1},color:{type:String,default:()=>pe.default.color,validator(e){return F.ui.colors.includes(e)}},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},uiRadio:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:o}){const{ui:n,attrs:m}=le("radioGroup",E(e,"ui"),pe,E(e,"class")),{ui:p}=le("radio",E(e,"uiRadio"),Pt),{emitFormChange:f,color:c,name:a}=_e(e,pe);ct("radio-group",{color:c,name:a});const t=b=>{o("update:modelValue",b),o("change",b),f()},u=b=>se(b,e.valueAttribute,se(b,e.optionAttribute)),k=b=>se(b,e.optionAttribute,se(b,e.valueAttribute)),C=b=>e.modelValue===u(b),$=b=>["string","number","boolean"].includes(typeof b)?{value:b,label:b}:{...b,value:u(b),label:k(b),selected:C(b)},V=A(()=>e.options.map(b=>$(b)));return{ui:n,uiRadio:p,attrs:m,normalizedOptions:V,onUpdate:t}}});function Et(e,o,n,m,p,f){const c=Me;return y(),U("div",{class:I(e.ui.wrapper)},[v("fieldset",R(e.attrs,{class:e.ui.fieldset}),[e.legend||e.$slots.legend?(y(),U("legend",{key:0,class:I(e.ui.legend)},[q(e.$slots,"legend",{},()=>[z(T(e.legend),1)])],2)):M("",!0),(y(!0),U(ve,null,me(e.normalizedOptions,a=>(y(),S(c,{key:a.value,label:a.label,"model-value":e.modelValue,value:a.value,help:a.help,disabled:a.disabled||e.disabled,ui:e.uiRadio,onChange:t=>e.onUpdate(a.value)},{label:d(()=>[q(e.$slots,"label",R({ref_for:!0},{option:a,selected:a.selected}))]),help:d(()=>[q(e.$slots,"help",R({ref_for:!0},{option:a,selected:a.selected}))]),_:2},1032,["label","model-value","value","help","disabled","ui","onChange"]))),128))],16)],2)}const qt=re(Ht,[["render",Et]]),Jt={class:"p-4 flex flex-col gap-2"},Kt=N({__name:"DoubanEdit",props:{type:{},typeModifiers:{},data:{default:{id:""}},dataModifiers:{}},emits:["update:type","update:data"],setup(e){const o=w(!1),n=async c=>{o.value=!0;const a=m.value==="book"?"/memo/getDoubanBookInfo":"/memo/getDoubanMovieInfo";try{const t=await te(`${a}?id=${p.value.id}`);Object.assign(p.value,t),c()}finally{o.value=!1}},m=Z(e,"type"),p=Z(e,"data"),f=c=>{m.value="book",p.value={id:""},c()};return(c,a)=>{const t=qt,u=Q,k=W,C=ae,$=X;return y(),S($,{ui:{base:"w-[300px]"},popper:{arrow:!0},mode:"click"},{panel:d(({close:V})=>[v("div",Jt,[s(t,{legend:"选择类型",modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=b=>m.value=b),options:[{value:"book",label:"豆瓣读书"},{value:"movie",label:"豆瓣电影"}]},null,8,["modelValue"]),s(u,{modelValue:p.value.id,"onUpdate:modelValue":a[1]||(a[1]=b=>p.value.id=b),type:"text",size:"sm",placeholder:"请输入豆瓣读书/豆瓣电影的ID"},null,8,["modelValue"]),s(C,null,{default:d(()=>[s(k,{onClick:b=>n(V),disabled:l(o),loading:l(o)},{default:d(()=>a[2]||(a[2]=[z("确定")])),_:2},1032,["onClick","disabled","loading"]),s(k,{color:"white",onClick:b=>f(V)},{default:d(()=>a[3]||(a[3]=[z("清空并关闭")])),_:2},1032,["onClick"])]),_:2},1024)])]),default:d(()=>[a[4]||(a[4]=v("svg",{class:"focus:outline-0 cursor-pointer w-6 h-6",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","data-state":"closed"},[v("path",{d:"M15.2735 15H5V7H19V15H17.3764L16.0767 19H21V21H3V19H7.6123L6.8 16.5L8.70211 15.882L9.71522 19H13.9738L15.2735 15ZM3.5 3H20.5V5H3.5V3ZM7 9V13H17V9H7Z"})],-1))]),_:1})}}}),Yt=ne(F.ui.strategy,F.ui.contextMenu,kt),Zt=N({inheritAttrs:!1,props:{modelValue:{type:Boolean,default:!1},virtualElement:{type:Object,required:!0},popper:{type:Object,default:()=>({})},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","close"],setup(e,{emit:o}){const{ui:n,attrs:m}=le("contextMenu",E(e,"ui"),Yt),p=A(()=>pt({},e.popper,n.value.popper)),f=A({get(){return e.modelValue},set(u){o("update:modelValue",u)}}),c=E(e,"virtualElement"),[,a]=yt(p.value,c),t=A(()=>he(H(n.value.container,n.value.width),e.class));return Ke(a,()=>{f.value=!1}),{ui:n,attrs:m,isOpen:f,wrapperClass:t,popper:p,container:a}}});function Qt(e,o,n,m,p,f){return e.isOpen?(y(),U("div",R({key:0,ref:"container",class:e.wrapperClass},e.attrs),[s(vt,R({appear:""},e.ui.transition),{default:d(()=>[v("div",null,[e.popper.arrow?(y(),U("div",{key:0,"data-popper-arrow":"",class:I(Object.values(e.ui.arrow))},null,2)):M("",!0),v("div",{class:I([e.ui.base,e.ui.ring,e.ui.rounded,e.ui.shadow,e.ui.background])},[q(e.$slots,"default")],2)])]),_:3},16)],16)):M("",!0)}const Wt=re(Zt,[["render",Qt]]),Xt={class:"p-4 flex flex-col gap-2"},el={key:0,class:"text-xs text-gray-400"},tl={key:1,class:"text-xs text-gray-400"},ll=N({__name:"UploadImage",props:{imgs:{},imgsModifiers:{}},emits:["update:imgs"],setup(e){const o=Z(e,"imgs"),n=w(0),m=w(""),p=w(0),f=w(0),c=async t=>{for(let k=0;k<t.length;k++)if(t[k].type.indexOf("image")<0){G.error("只能上传图片");return}const u=await ye(t,(k,C,$,V)=>{n.value=Math.round(V*100),m.value=$,p.value=k,f.value=C});G.success("上传成功"),u&&setTimeout(()=>{o.value=(o.value?o.value+",":"")+u.join(",")},200)},a=t=>{o.value="",t()};return(t,u)=>{const k=oe,C=Q,$=Ue,V=Ve,b=W,B=ae,_=X;return y(),S(_,{popper:{arrow:!0},mode:"click"},{panel:d(({close:i})=>[v("div",Xt,[u[3]||(u[3]=v("div",{class:"text-xs text-gray-400"},"本地上传",-1)),s(C,{type:"file",size:"sm",icon:"i-heroicons-folder",onChange:c,multiple:""}),s($,{rows:5,placeholder:"或者输入在线图片地址,逗号分隔,最多9张",modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=x=>o.value=x)},null,8,["modelValue"]),l(m)?(y(),U("p",el,"正在上传("+T(l(f))+"/"+T(l(p))+")",1)):M("",!0),l(m)?(y(),U("p",tl,T(l(m)),1)):M("",!0),l(n)>0?(y(),S(V,{key:2,value:l(n),indicator:""},null,8,["value"])):M("",!0),s(B,{class:"w-fit"},{default:d(()=>[s(b,{onClick:x=>i()},{default:d(()=>u[1]||(u[1]=[z("确定")])),_:2},1032,["onClick"]),s(b,{color:"white",onClick:x=>a(i)},{default:d(()=>u[2]||(u[2]=[z("清空并关闭")])),_:2},1032,["onClick"])]),_:2},1024)])]),default:d(()=>[s(k,{name:"i-carbon-image",class:"cursor-pointer w-6 h-6"})]),_:1})}}}),ol={class:"px-4 space-y-2"},al={class:"flex gap-2 text-lg text-gray-600 pt-4"},nl={key:0,class:"truncate"},sl={key:1},rl={class:"px-2 py-1 flex flex-col gap-2 text-xs"},il={class:"flex justify-between items-center"},ul={class:"flex flex-row gap-1 items-center text-[#576b95] text-sm cursor-pointer"},dl={class:"flex items-center gap-1"},cl={class:"p-4"},pl={class:"flex gap-1 text-gray-500 gap-4"},vl={class:"flex gap-1 items-center"},ml={class:"flex flex-col gap-2"},Vl=N({__name:"MemoEdit",props:{id:{}},setup(e){const o=w("book"),n=w({}),m=w(null),f={id:e.id||0,content:"",ext:"",pinned:!1,showType:!0,location:"",externalFavicon:"",externalTitle:"",externalUrl:"",imgs:"",music:{id:"",api:"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r",server:"netease",type:"song"},video:{type:"youtube",value:""},doubanBook:{},doubanMovie:{},tags:Array()},c=w([]),a=A({get:()=>c.value,set:g=>{const r=Array();g.map(L=>{typeof L!="string"&&(L=L.label),r.push(L),u.value.includes(L)||u.value.push(L)}),c.value=[...r],console.log("selectedTags",c.value)}}),t=mt({...f}),u=w([]),k=()=>{Object.assign(t,f)},C=A(()=>t.location.split(" ").join(" · ")),$=g=>{t.imgs=g.join(",")},V=g=>{t.music.id="",setTimeout(()=>{Object.assign(t.music,g)},500)},b=g=>{t.video=g},{x:B,y:_}=Ye(),{y:i}=Ze(),x=w(!1),O=w({getBoundingClientRect:()=>({})}),j=g=>{const r=t.imgs.split(","),L=r.findIndex(ie=>ie===g);L<0||(r.splice(L,1),t.imgs=r.join(","))};function P(){if(u.value.length<=0)return;const g=l(_)-l(i),r=l(B);O.value.getBoundingClientRect=()=>({width:0,height:0,top:g,left:r}),x.value=!0}const ee=async()=>{const g=await te("/tag/list");u.value=g.tags||[]},J=g=>{var r;x.value=!1,a.value.includes(g)||(a.value?a.value=[...a.value,g]:a.value=[g]),((r=m.value)==null?void 0:r.textarea).focus()};ft(async()=>{if(t.id>0){const g=await te("/memo/get?id="+t.id);Object.assign(t,g),t.showType=g.showType===1;const r=JSON.parse(g.ext);Object.assign(t.music,r.music),Object.assign(t.video,r.video),o.value=r.doubanBook&&r.doubanBook.title?"book":"movie",n.value=o.value==="book"?r.doubanBook:r.doubanMovie,a.value=g.tags?g.tags.substring(0,g.tags.length-1).split(","):[]}await ee()});const K=async()=>{const g=o.value==="book"?"doubanBook":"doubanMovie";await te("/memo/save",{id:t.id,content:t.content,ext:{music:t.music.id?t.music:{},[g]:n.value,video:t.video.value?t.video:{}},pinned:t.pinned,showType:t.showType?1:0,externalFavicon:t.externalUrl?t.externalFavicon:"",externalTitle:t.externalTitle,externalUrl:t.externalUrl,imgs:t.imgs.split(","),location:t.location,tags:a.value}),G.success("保存成功!"),await be("/")};return(g,r)=>{const L=Ct,ie=At,ze=Ft,Ae=Kt,fe=oe,Be=$e,Oe=Ue,Te=Xe,Se=Wt,Ie=Q,ue=W,ge=ae,je=X,Fe=_t,Re=et,Le=tt,De=xe,Ge=lt,Ne=ot,Pe=at,He=nt,Ee=st;return y(),U("div",ol,[v("div",al,[s(L,{favicon:l(t).externalFavicon,"onUpdate:favicon":r[0]||(r[0]=h=>l(t).externalFavicon=h),title:l(t).externalTitle,"onUpdate:title":r[1]||(r[1]=h=>l(t).externalTitle=h),url:l(t).externalUrl,"onUpdate:url":r[2]||(r[2]=h=>l(t).externalUrl=h)},null,8,["favicon","title","url"]),s(ll,{imgs:l(t).imgs,"onUpdate:imgs":r[3]||(r[3]=h=>l(t).imgs=h)},null,8,["imgs"]),s(ie,R(l(t).music,{onConfirm:V}),null,16),s(ze,R({onConfirm:b},l(t).video),null,16),s(Ae,{type:l(o),"onUpdate:type":r[4]||(r[4]=h=>D(o)?o.value=h:null),data:l(n),"onUpdate:data":r[5]||(r[5]=h=>D(n)?n.value=h:null)},null,8,["type","data"]),s(fe,{name:"i-carbon-text-clear-format",onClick:k,class:"w-6 h-6 cursor-pointer",title:"清空"})]),v("div",{class:"w-full",onContextmenu:gt(P,["prevent"])},[s(Be,{modelValue:l(a),"onUpdate:modelValue":r[6]||(r[6]=h=>D(a)?a.value=h:null),options:l(u),"show-create-option-when":"always",multiple:"",searchable:"",creatable:"",placeholder:"选择标签",class:"my-2"},{label:d(()=>[l(a).length?(y(),U("span",nl,T(l(a).join(",")),1)):(y(),U("span",sl,"选择标签"))]),_:1},8,["modelValue","options"]),s(Oe,{ref_key:"contentRef",ref:m,modelValue:l(t).content,"onUpdate:modelValue":r[7]||(r[7]=h=>l(t).content=h),rows:8,autoresize:"",padded:"",autofocus:""},null,8,["modelValue"]),s(Se,{modelValue:l(x),"onUpdate:modelValue":r[8]||(r[8]=h=>D(x)?x.value=h:null),"virtual-element":l(O)},{default:d(()=>[v("div",rl,[r[12]||(r[12]=v("div",{class:"mb-2 text-gray-300"},"点击标签插入",-1)),(y(!0),U(ve,null,me(l(u),(h,de)=>(y(),U("div",{key:de,class:"cursor-pointer"},[s(Te,{size:"xs",color:"gray",variant:"solid",onClick:fl=>J(h)},{default:d(()=>[z(T(h),1)]),_:2},1032,["onClick"])]))),128))])]),_:1},8,["modelValue","virtual-element"])],32),v("div",il,[v("div",ul,[s(je,{popper:{arrow:!0},mode:"click"},{panel:d(({close:h})=>[v("div",cl,[s(ge,null,{default:d(()=>[s(Ie,{modelValue:l(t).location,"onUpdate:modelValue":r[9]||(r[9]=de=>l(t).location=de),placeholder:"自定义位置,空格分隔"},null,8,["modelValue"]),s(ue,{onClick:h,color:"white",variant:"solid"},{default:d(()=>r[13]||(r[13]=[z("关闭")])),_:2},1032,["onClick"])]),_:2},1024)])]),default:d(()=>[v("div",dl,[s(fe,{name:"i-carbon-location"}),v("span",null,T(l(t).location?l(C):"自定义位置"),1)])]),_:1})]),v("div",pl,[v("div",vl,[v("span",null,T(l(t).showType?"公开":"私密"),1),s(Fe,{modelValue:l(t).showType,"onUpdate:modelValue":r[10]||(r[10]=h=>l(t).showType=h)},null,8,["modelValue"])]),s(ge,null,{default:d(()=>[s(ue,{color:"gray",variant:"solid",onClick:r[11]||(r[11]=h=>("navigateTo"in g?g.navigateTo:l(be))("/"))},{default:d(()=>r[14]||(r[14]=[z("返回")])),_:1}),s(ue,{onClick:K},{default:d(()=>r[15]||(r[15]=[z("发表")])),_:1})]),_:1})])]),v("div",ml,[s(Re,{favicon:l(t).externalFavicon,title:l(t).externalTitle,url:l(t).externalUrl},null,8,["favicon","title","url"]),s(Le,{imgs:l(t).imgs,onRemoveImage:j,onDragImage:$},null,8,["imgs"]),l(t).music&&l(t).music.id&&l(t).music.type&&l(t).music.server?(y(),S(De,ke(R({key:0},l(t).music)),null,16)):M("",!0),l(o)==="book"&&l(n)&&l(n).title?(y(),S(Ge,{key:1,book:l(n)},null,8,["book"])):M("",!0),l(o)==="movie"&&l(n)&&l(n).title?(y(),S(Ne,{key:2,movie:l(n)},null,8,["movie"])):M("",!0),l(t).video.type==="youtube"&&l(t).video.value?(y(),S(Pe,{key:3,url:l(t).video.value},null,8,["url"])):M("",!0),l(t).video.type==="bilibili"&&l(t).video.value?(y(),S(He,{key:4,url:l(t).video.value},null,8,["url"])):M("",!0),l(t).video.type==="online"&&l(t).video.value?(y(),S(Ee,{key:5,url:l(t).video.value},null,8,["url"])):M("",!0)])])}}});export{Vl as _};
